"""Game progression steps and execution"""

import time
import threading

from utils.screenshot_utils import take_screenshot

from macros import *

from .opencv_logics import *


def get_game_steps():
    """Get the complete list of game progression steps
    
    Returns:
        list: List of (description, function, coords, sleep_duration) tuples
    """
    steps = [
        ('Login', tap_macro, (640, 560), 5),
        ('Guest Account', tap_macro, (840, 285), 6),
        ('Confirm', tap_macro, (895, 520), 15),
        ('Confirm Guest', tap_macro, (630, 615), 16),
        ('Confirm Server', tap_macro, (625, 495), 8),
        ('Choose Voice', tap_macro, (625, 360), 3),
        ('Confirm Voice', tap_macro, (625, 495), 12),
        ('Confirm Download', tap_macro, (860, 500), 20),       # Start
        ('Checking Start', check_start, None, 1),
        ('Settings', tap_macro, (1205, 560), 10),
        ('Choose Detail 1', tap_macro, (1020, 275), 2),
        ('Low Detail 1', tap_macro, (1030, 380), 1),
        ('Choose Detail 2', tap_macro, (1020, 330), 2),
        ('Low Detail 2', tap_macro, (1030, 430), 1),    
        ('Choose Detail 3', tap_macro, (1020, 385), 2),
        ('Low Detail 3', tap_macro, (1030, 485), 1),
        ('Choose Detail 4', tap_macro, (1020, 440), 2),
        ('Low Detail 4', tap_macro, (1030, 540), 1),
        ('Choose Detail 5', tap_macro, (1020, 495), 2),
        ('Low Detail 5', tap_macro, (1030, 595), 3),
        ('Apply', tap_macro, (1120, 645), 5),
        ('Sound', tap_macro, (60, 235), 6),
        ('Mute', tap_macro, (1200, 165), 3),
        ('Close Settings', tap_macro, (1200, 60), 10),

        ('Global', tap_macro, (1, 1), 8),
        ('Global', tap_macro, (1, 1), 2),
        ('Skip Video', tap_macro, (1155, 45), 5),
        ('Skip Confirm', tap_macro, (849, 459), 8),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 16000), 17),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 7000), 10),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 3500), 6),

        #Battle Started First
        ('Global', tap_macro, (1, 1), 4),
        ('Global', tap_macro, (1, 1), 4),
        ('First Step', swipe_macro, (787, 577, 900, 365, 1500), 8),
        ('Global', tap_macro, (1, 1), 5),
        ('Global', tap_macro, (1, 1), 3),
        ('Global', tap_macro, (1, 1), 4),
        ('Global', tap_macro, (1, 1), 4),
        ('Global', tap_macro, (1, 1), 5),
        ('Second Step', swipe_macro, (901, 584, 886, 365, 1500), 5),
        ('Global', tap_macro, (1, 1), 5),
        ('R', swipe_macro, (787, 577, 900, 365, 1500), 8),
        ('Global', tap_macro, (1, 1), 5),
        ('Global', tap_macro, (1, 1), 5), 
        ('Skip Turn', tap_macro, (1142, 623), 10),
        ('Center Skill', swipe_macro, (640, 594, 993, 378, 1500 ), 2),
        ('Follow Skill', swipe_macro, (720, 592, 993, 378, 1500), 2),
        ('Center Skill', swipe_macro, (640, 594, 993, 378, 1500), 2),
        ('Follow Skill', swipe_macro, (720, 592, 993, 378, 1500), 2),
        ('Center Skill', swipe_macro, (640, 594, 993, 378, 1500), 2),
        ('Skip Turn', tap_macro, (1142, 623), 8),
        ('Center Skill', swipe_macro, (640, 594, 735, 333, 1500), 2),
        ('Follow Skill', swipe_macro, (720, 592, 735, 333, 1500), 2),
        ('Center Skill', swipe_macro, (640, 594, 735, 333, 1500), 8),
    
        ('3x', swipe_macro, (1232, 233, 1232, 333, 9000), 10),
        ('Global', tap_macro, (660, 1), 8),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 3000), 5),
        ('Global', tap_macro, (660, 1), 10),
        ('Global', tap_macro, (660, 1), 5),
        ('Center Skill', swipe_macro, (640, 594, 914, 405, 1500), 7),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Tutorial Skill', swipe_macro, (917, 623, 914, 405, 1500), 5),
        ('Follow Skill', swipe_macro, (720, 592, 914, 405, 1500), 7),
        ('Battle Continue', tap_macro, (1140, 667), 7) ,
        ('3x', swipe_macro, (1232, 233, 1232, 333, 9000), 10),
        ('Click Name', tap_macro, (640, 333), 3),
        ('Input Name', "input_name", None, 3),
        ('Confirm Name', tap_macro, (648, 478), 3),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 16000), 18  ),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Test Screenshot', take_screenshot, None, 1),

        # Prologue 2
        ('Prologue 2', tap_macro, (687, 361), 4),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 15000), 16),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 3000), 5),
        ('Global', tap_macro, (660, 1), 3),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 4000), 7),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 814, 397, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Follow Skill left', swipe_macro, (547, 601, 814, 397, 1500), 4),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 10),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 814, 397, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 814, 397, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 8),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 814, 397, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 814, 397, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 814, 397, 1500), 7),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Skip Turn', tap_macro, (1142, 623), 8),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 3),
        ('Center Skill', swipe_macro, (640, 594, 914, 405, 1500), 7),
        ('Follow Skill', swipe_macro, (720, 592, 914, 405, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 914, 405, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 8),
        ('Center Skill', swipe_macro, (640, 594, 993, 378, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 993, 378, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 993, 378, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 993, 378, 1500), 10),
        ('Battle Continue', tap_macro, (1140, 667), 5),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 4000), 8),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 4000), 10),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 2000), 6),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 3000), 5),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 4000), 25),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 6000), 13),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Center Skill', swipe_macro, (640, 594, 923, 237, 1500), 4),
        ('Follow Skill', swipe_macro, (720, 592, 923, 237, 1500), 4),
        ('Center Skill', swipe_macro, (640, 594, 923, 237, 1500), 6),
        ('Skip Turn', tap_macro, (1142, 623), 10),
        ('Center Skill', swipe_macro, (640, 594, 923, 237, 1500), 5),
        ('Center Skill', swipe_macro, (640, 594, 923, 237, 1500), 4),
        ('Follow Skill', swipe_macro, (720, 592, 923, 237, 1500), 4),
        ('Skip Turn', tap_macro, (1142, 623), 9),
        ('Skip Turn', tap_macro, (1142, 623), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Follow Skill', swipe_macro, (720, 592, 923, 237, 3000), 19),
        ('Global', tap_macro, (660, 1), 18),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 10),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 6),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 4000), 6),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 4000), 34),
        ('Battle Continue', tap_macro, (1140, 667), 6),

        # EP - 1
        ('Choose Stage', tap_macro, (645, 365), 4),
        ('Battle Continue', tap_macro, (1140, 667), 8),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 28000), 30),
        # ('3x', swipe_macro, (1232, 233, 1232, 333, 9000), 12),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Global', tap_macro, (660, 1), 8), 
        ('Summon - 1', tap_macro, (853, 660), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Skip Video', tap_macro, (1155, 45), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Return', tap_macro, (51, 32), 5),
        
        # Ep - 2
        ('Choose Stage', tap_macro, (720, 365), 10),
        ('Choose Stage', tap_macro, (720, 365), 5),
        ('Global', tap_macro, (660, 1), 2),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Global', tap_macro, (660, 1), 3),
        ('Team Formation 1', tap_macro, (170, 350), 3),
        ('New Char 1', tap_macro, (785, 198), 3),
        ('Assign Team', tap_macro, (1140, 667), 4),
        ('Team Enter', tap_macro, (1140, 667), 18),
        ('Global', tap_macro, (660, 1), 2),
        ('Skip Video', tap_macro, (1155, 45), 5),
        ('Skip Confirm', tap_macro, (849, 459), 8),
        ('Menu', tap_macro, (1226, 39), 4),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 3),
        ('Ep - 2 Map 1', tap_macro, (838, 153), 12),
        ('Center Skill', swipe_macro, (640, 594, 795, 390, 1500), 6),
        ('Center Skill', swipe_macro, (640, 594, 795, 390, 1500), 5),
        ('Follow Skill', swipe_macro, (720, 592, 795, 390, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 795, 390, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 795, 390, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 795, 390, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 795, 390, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 795, 390, 1500), 5),
        ('Center Skill', swipe_macro, (640, 594, 1060, 418, 1500), 5),
        ('Skip Turn', tap_macro, (1142, 623), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Center Skill', swipe_macro, (640, 594, 1060, 418, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 1060, 418, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 1060, 418, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 8),
        ('Center Skill', swipe_macro, (640, 594, 1060, 418, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 1060, 418, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 1060, 418, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 1060, 418, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 1060, 418, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 1060, 418, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 1060, 418, 1500), 6),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        
        ('Next Map', tap_macro, (1015, 367), 6),
        ('Rest Free', tap_macro, (420, 536), 10),
        ('Rest Confirm', tap_macro, (896, 486), 8),
        ('Rest Leave', tap_macro, (1140, 667), 4),

        ('Next Map', tap_macro, (1015, 367), 12),
        ('Global', tap_macro, (660, 1), 3),
        ('Tut 1', tap_macro, (803, 619), 2),
        ('Tut Explore', tap_macro, (947, 486), 5),
        ('Tut 1', tap_macro, (803, 619), 3),
        ('Up Tut', tap_macro, (803, 377), 3),
        ('Global', tap_macro, (660, 1), 6),
        ('Global', tap_macro, (660, 1), 20),
        ('Global', tap_macro, (660, 1), 3),
        ('Char 2 Sword', tap_macro, (973, 376), 3),
        ('Battle Continue', tap_macro, (1140, 667), 10),
        ('Global', tap_macro, (660, 1), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Battle Continue', tap_macro, (1140, 667), 5),
        ('Next Map', tap_macro, (1015, 367), 12),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Test Screenshot', take_screenshot, None, 1),

        ('Center Skill', swipe_macro, (640, 594, 801, 392, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 392, 1500), 3),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 3),
        ('Tap Skill Upgrade', tap_macro, (325, 374), 4),
        ('Follow Skill', swipe_macro, (720, 592, 801, 392, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 392, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 392, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 392, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 392, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 392, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 6),
        ('Center Skill', swipe_macro, (640, 594, 801, 392, 1500), 9),
        ('Follow Skill', swipe_macro, (720, 592, 801, 392, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 392, 1500), 5),
        ('Center Skill', swipe_macro, (640, 594, 801, 392, 1500), 7),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Test Screenshot', take_screenshot, None, 1),

        ('Next Map', tap_macro, (1015, 367), 12),
        ('Global', tap_macro, (660, 1), 3),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 3000), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 10),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 4 ),
        ('Attack', tap_macro, (1208, 624), 4),
        ('Attacking', tap_macro, (636, 591), 5),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 420, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 15),
        ('Global', tap_macro, (660, 1), 2),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 420, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 420, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Follow Skill Left', swipe_macro, (547, 601, 801, 420, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        # ('Skip Turn', tap_macro, (1142, 623), 8),
        # ('Battle Continue', tap_macro, (1140, 667), 6),

        # 'EP 1 Char' - 122, 525
        # 'EP 2 Char' - 125, 594
        # 'EP 3 Char' - 128, 660

        # ('Ep 2 Skill', tap_macro, (125, 594), 2),
        # ('Ep 2 Skill Confirm', tap_macro, (801, 420), 13), 
        ('Skip Turn', tap_macro, (1142, 623), 9),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Follow Skill Left', swipe_macro, (537, 601, 801, 420, 1500), 4),
        ('Follow Skill left', swipe_macro, (537, 601, 801, 420, 1500), 4),
        ('Follow Skill left', swipe_macro, (537, 601, 801, 420, 1500), 4),
        ('Skip Turn', tap_macro, (1142, 623), 12),
        ('Center Skill', swipe_macro, (640, 594, 801, 420, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 801, 420, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 8),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 1),
        ('Battle Continue', tap_macro, (1140, 667), 8),

        # ('Menu', tap_macro, (1226, 39), 3),
        # ('Skip Menu', tap_macro, (1146, 39), 2),
        # ('Skip Confirm', tap_macro, (849, 459), 4),

        ('3x', swipe_macro, (1232, 233, 1232, 333, 8000), 10),

        ('Next Map', tap_macro, (1015, 367), 8),
        ('Menu', tap_macro, (1226, 39), 4),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 8),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 4),
        ('Global', tap_macro, (660, 1), 8),
        ('Center Message', tap_macro, (640, 615), 3),
        ('Center Message', tap_macro, (640, 615), 5),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 6),
        ('Global', tap_macro, (660, 1), 7),
        ('Global', tap_macro, (660, 1), 12),
        ('Choose Card', tap_macro, (628, 377), 8),
        ('Global', tap_macro, (660, 1), 6),
        ('Global', tap_macro, (660, 1), 4),
        ('Global', tap_macro, (660, 1), 5),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Battle Continue', tap_macro, (1140, 667),3),
        ('Next Map', tap_macro, (1015, 367), 12),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        
        ('Center Skill', swipe_macro, (640, 594, 934, 310, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 934, 310, 1500), 3),
        ('Follow Skill', swipe_macro, (750, 592, 934, 310, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 9),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Center Skill', swipe_macro, (640, 594, 934, 310, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 934, 310, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 3),
        ('Donot show again', tap_macro, (503, 360), 2),
        ('Confirm Donot show again', tap_macro, (844, 433), 20),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Skip Turn', tap_macro, (1142, 623), 9),
        ('Retry', tap_macro, (640, 657), 8),
        ('1st Skill', swipe_macro, (355, 626, 934, 310, 1500), 3),
        ('5th Skill', swipe_macro, (902, 616, 934, 310, 1500), 3),
        ('Follow Skill Left', swipe_macro, (537, 601, 934, 310, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 934, 310, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 934, 310, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 934, 310, 1500), 3),
        ('Follow Skill Left', swipe_macro, (527, 601, 934, 310, 1500), 14),
        ('Battle Continue', tap_macro, (1140, 667), 1),
        ('Battle Continue', tap_macro, (1140, 667), 8),
        ('Char Vest', tap_macro, (1064, 378), 2),
        ('Equip Vest', tap_macro, (1140, 667), 4),
        ('Battle Continue', tap_macro, (1140, 667), 3),
        ('Battle Continue', tap_macro, (1140, 667), 4),
        ('Battle Continue', tap_macro, (1140, 667), 4),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 4),

        ('Next Map', tap_macro, (1015, 367), 8),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 6),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 6),
        ('Examine 1', tap_macro, (741, 166), 4),
        ('Examine 2', tap_macro, (616, 366), 4),
        ('Examine 3', tap_macro, (848, 408), 4),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 6),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 12),
        # ('Ep 1 Skill', tap_macro, (122, 525), 2),
        # ('Ep 1 Skill Confirm', tap_macro, (926, 187), 11),
        ('Center Skill', swipe_macro, (640, 594, 926, 187, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 926, 187, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 5),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Follow Skill', swipe_macro, (720, 592, 926, 187, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 926, 187, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 926, 187, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 926, 187, 1500), 3),
        ('Follow Skill', swipe_macro, (720, 592, 926, 187, 1500), 3),
        ('Center Skill', swipe_macro, (640, 594, 926, 187, 1500), 3),
        ('Skip Turn', tap_macro, (1142, 623), 12),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 16),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Skip Menu', tap_macro, (1146, 39), 2),
        ('Skip Confirm', tap_macro, (849, 459), 5),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 4),
        ('Next Map', tap_macro, (1015, 367), 7),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 4),
        ('Message Center', tap_macro, (640, 615), 2),
        ('Message Center', tap_macro, (640, 615), 6),
        ('Battle Continue', tap_macro, (1140, 667), 4),
        ('Global', tap_macro, (660, 1), 6),
        ('Battle Continue', tap_macro, (1140, 667), 8),
        ('Battle Continue', tap_macro, (1140, 667), 10),
        ('Test Screenshot', take_screenshot, None, 1),
        
        # Ep - 3
        ('Choose Stage', tap_macro, (630, 360), 4),
        ('Checking Watch Again', watch_again, None, 3),
        ('Battle Continue', tap_macro, (1140, 667), 8),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 28000), 30),
        ('Battle Continue', tap_macro, (1140, 667), 10),
        ('Global', tap_macro, (660, 1), 2),
        ('Proceed with Tut', tap_macro, (619, 454), 7),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Missions', tap_macro, (1211, 117), 6), 
        ('Mission Right', tap_macro, (1211, 117), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('B1', tap_macro, (634, 362), 3),
        ('Battle Continue', tap_macro, (1140, 667), 2),
        ('Battle Continue', tap_macro, (1140, 667), 2),
        ('Battle Continue', tap_macro, (1140, 667), 6),
        ('Global', tap_macro, (660, 1), 2), 
        ('Data Center', tap_macro, (448, 538), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Space', tap_macro, (1141, 663), 2),
        ('Space', tap_macro, (1141, 663), 3),
        ('Data Left', tap_macro, (145, 231), 3), 
        ('Global', tap_macro, (660, 1), 2),
        ('Space', tap_macro, (1141, 663), 2),
        ('Return', tap_macro, (51, 32), 3),
        ('Return', tap_macro, (51, 32), 3),
        ('Space', tap_macro, (1141, 663), 2),
        ('Space', tap_macro, (1141, 663), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Pet Required', tap_macro, (995, 292), 4),
        ('Assign Partner', tap_macro, (711, 344), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Space', tap_macro, (1141, 663), 3),
        ('Return', tap_macro, (51, 32), 3),
        ('Pet 2nd', tap_macro, (529, 442), 4), 
        ('Assign Partner', tap_macro, (711, 344), 4),
        ('Space', tap_macro, (1141, 663), 3),
        ('Return', tap_macro, (51, 32), 3),
        ('Pet 3rd',tap_macro, (787, 442), 2), 
        ('Assign Partner', tap_macro, (711, 344), 4),
        ('Space', tap_macro, (1141, 663), 3),
        ('Return', tap_macro, (51, 32), 5),
        ('Battle Continue', tap_macro, (1140, 667), 18),
        ('Global', tap_macro, (660, 1), 2),
        ('Auto Fight', tap_macro, (1124, 40), 88),
        ('Check Fight Ended', check_confirm, None, 3),
        ('Battle Continue', tap_macro, (1140, 667), 5),

        # B2
        ('B2', tap_macro, (659, 357), 4),
        ('Space', tap_macro, (1141, 663), 6),
        ('Space', tap_macro, (1141, 663),120),
        ('Check Fight Ended', check_confirm, None, 3),
        ('Battle Continue', tap_macro, (1140, 667), 4),
        ('Test Screenshot', take_screenshot, None, 1),

        # B3
        ('B3', tap_macro, (660, 362), 4), 
        ('Space', tap_macro, (1141, 663), 6),
        ('Char Req', tap_macro, (470, 271), 6),
        ('Char Details', tap_macro, (771, 673), 7),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Space', tap_macro, (1141, 663), 8),   
        ('Auto Register', tap_macro, (1105, 604), 6),
        ('Space', tap_macro, (1141, 663), 6),
        ('Space', tap_macro, (1141, 663), 6),
        ('Global', tap_macro, (660, 1), 4),
        ('Global', tap_macro, (660, 1), 5),
        ('Another Char 1', find_char1, (51, 274), 3),
        ('Space', tap_macro, (1141, 663), 3),
        ('Auto Register', tap_macro, (1105, 604), 3),
        ('Space', tap_macro, (1141, 663), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 4),
        ('Return', tap_macro, (51, 32), 6),
        ('Another Char 2', find_char2, (51, 193), 3),
        ('Space', tap_macro, (1141, 663), 3),
        ('Auto Register', tap_macro, (1105, 604), 3),
        ('Space', tap_macro, (1141, 663), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 4),
        ('Return', tap_macro, (51, 32), 3),
        ('Return', tap_macro, (51, 32), 6),
        ('Return', tap_macro, (51, 32), 6),
        ('Space', tap_macro, (1141, 663), 110),
        ('Check Fight Ended', check_confirm, None, 3),
        ('Battle Continue', tap_macro, (1140, 667), 8),

        ('Proceed with Tut', tap_macro, (619, 454), 10),
        ('Global', tap_macro, (660, 1), 2),
        ('Missions', tap_macro, (1211, 117), 8),
        ('Mission Left', tap_macro, (294, 380), 4),
        
        # 4-1
        ('4-1', tap_macro, (644, 360), 3),
        ('Space', tap_macro, (1141, 663), 2),
        ('Battle Continue', tap_macro, (1140, 667), 8),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 18000), 20),
        ('Space', tap_macro, (1141, 663), 6),
        ('Proceed with Tut', tap_macro, (619, 454), 12),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),

        # Chaos
        ('Chaos', tap_macro, (1212, 258), 8),
        ('Global', tap_macro, (660, 1), 2),
        ('Chaos Left', tap_macro, (294, 380), 8),
        ('Blue Pot', tap_macro, (295, 488), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Space', tap_macro, (1141, 663), 8),
        ('Global', tap_macro, (660, 1), 4),
        ('Team Formation 1', tap_macro, (178, 345), 6),
        ('Char Details', tap_macro, (771, 673), 7),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('Return', tap_macro, (51, 32), 6),
        ('Return', tap_macro, (51, 32), 6),
        ('Space', tap_macro, (1141, 663), 18),
        ('Research', find_research, None, 3),
        ('Space', tap_macro, (1141, 663), 9),
        ('Space', tap_macro, (1141, 663), 6),
        ('Space', tap_macro, (1141, 663), 8),
        ('Global', tap_macro, (660, 1), 8),

        # Blue Pot - 1
        ('Chaos Top Stage', tap_macro, (847, 162), 18),
        ('Fight', fighting_logic, None, 3),
        ('Fight Skip', tap_macro, (873, 661), 4),
        ('Fight Skip Confirm', tap_macro, (922, 455), 3),
        ('Global', tap_macro, (660, 1), 6),
        ('Map Middle', tap_macro, (1017, 370), 4),
        ('Rest Free', tap_macro, (420, 536), 10),
        ('Rest Confirm', tap_macro, (896, 486), 8),
        ('Rest Leave', tap_macro, (1140, 667), 4),
        ('Global', tap_macro, (660, 1), 3),
        ('Global', tap_macro, (660, 1), 3),
        ('R', tap_macro, (801, 584), 2),
        ('R', tap_macro, (801, 584), 8),
        ('Global', tap_macro, (660, 1), 1),
        ('Global', tap_macro, (660, 1), 2),
        ('Space', tap_macro, (1141, 663), 6),
        
        ('Menu', tap_macro, (1226, 39), 3),
        ('Space', tap_macro, (1141, 663), 5),
        ('Escape Confirm', tap_macro, (849, 459), 10),
        ('Space', tap_macro, (1141, 663), 4),
        ('Space', tap_macro, (1141, 663), 8),
        ('Return', tap_macro, (51, 32), 2),
        ('Return', tap_macro, (51, 32), 2),
        ('Return', tap_macro, (51, 32), 2),
        ('Return', tap_macro, (51, 32), 2),
        ('Return', tap_macro, (51, 32), 6),
        ('Test Screenshot', take_screenshot, None, 1),

        ('Proceed with Tut', tap_macro, (619, 454), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),

        ('Simulation', tap_macro, (1207, 198), 12),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Simulation Left', tap_macro, (153, 349), 7),
        ('Global', tap_macro, (660, 1), 2),
        ('Tactical Training Tut', tap_macro, (1026, 284), 8),
        ('Global', tap_macro, (660, 1), 4),
        ('Training Add', tap_macro, (1243, 603), 1),
        ('Training Add', tap_macro, (1243, 603), 1),
        ('Space', tap_macro, (1141, 663), 12),
        ('Auto Fight', tap_macro, (1124, 40), 115),
        ('Checking Confirm', check_confirm, None, 1),
        ('Retry Simulation', tap_macro, (858, 662), 115),
        ('Checking Confirm', check_confirm, None, 1),
        ('Retry Simulation', tap_macro, (858, 662), 115),  
        ('Checking Confirm', check_confirm, None, 1),
        ('Retry Simulation', tap_macro, (858, 662), 115), 
        ('Checking Confirm', check_confirm, None, 1),
        ('Space', tap_macro, (1141, 663), 10),
        ('Return', tap_macro, (51, 32), 4),
        ('Return', tap_macro, (51, 32), 2),
        ('Return', tap_macro, (51, 32), 2),
        ('Return', tap_macro, (51, 32), 6),
        ('Proceed with Tut', tap_macro, (619, 454), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Missions', tap_macro, (1211, 117), 8),
        ('Mission Left', tap_macro, (294, 380), 6),
        ('Tutorail Stage', tap_macro, (647, 361), 4),
        ('Space', tap_macro, (1141, 663), 2),
        ('Return', tap_macro, (51, 32), 4),
        ('Return', tap_macro, (51, 32), 10),  
        ('Mission Achive', tap_macro, (168, 182), 4),
        ('Growth Guide Reward 1', tap_macro, (278, 615), 3),
        ('Global', tap_macro, (660, 1), 2),
        ('Growth Guide Reward 2', tap_macro, (523, 615), 3),
        ('Global', tap_macro, (660, 1), 2),
        ('Growth Guide Reward 3', tap_macro, (770, 615), 3),
        ('Global', tap_macro, (660, 1), 2),  
        ('Growth Guide Reward 4', tap_macro, (1026, 615), 3),
        ('Global', tap_macro, (660, 1), 2),
        ('Achievement Log', tap_macro, (79, 249), 4),
        ('Log Claim', tap_macro, (1029, 205), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Achievement Schedule', tap_macro, (79, 87), 4),
        ('Schedule Claim', tap_macro, (248, 574), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Close Achievement', tap_macro, (1203, 81), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Mail', tap_macro, (1230, 204), 8),
        ('Claim All Mail', tap_macro, (180, 650), 15),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 4),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Achievement Menu', tap_macro, (1019, 323), 5),
        ('Journey Log', tap_macro, (180, 412), 4),
        ('Claim All Log', tap_macro, (1127, 117), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Overcoming Adversity', tap_macro, (123, 277), 4),
        ('Claim All Log', tap_macro, (1127, 117), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Menu Missions', tap_macro, (814, 76), 8),
        ('Mission Right', tap_macro, (1211, 117), 4),
        ('Click Mission Rewards', tap_macro, (680, 670), 4),
        ('Claim Mission Rewards', tap_macro, (1100, 190), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 4),
        ('Return', tap_macro, (51, 32), 3),
        ('Mission Left', tap_macro, (294, 380), 4),
        
        # 5
        ('Mission 5', tap_macro, (640, 360), 4),
        ('Space', tap_macro, (1141, 663), 12),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 4000), 5),
        ('Click Talk', tap_macro, (600, 270), 4),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 25000), 28),
        ('Space', tap_macro, (1141, 663), 6),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),

        ('Mission 5-1', tap_macro, (553, 252), 4),
        ('Space', tap_macro, (1141, 663), 12),
        ('3x', swipe_macro, (1232, 233, 1232, 333, 29000), 32),
        ('Global', tap_macro, (700, 1), 2),
        ('Global', tap_macro, (700, 1), 2),
        ('Global', tap_macro, (700, 1), 2),

        ('Menu', tap_macro, (1226, 39), 3),
        ('Event', tap_macro, (1010, 70), 12),
        ('Galactic News', tap_macro, (130, 400), 4),
        ('Galactic News', tap_macro, (720, 415), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Claim Rewards Event', claim_rewards, None, 2),
        ('Scroll Event', swipe_macro, (120, 690, 120, 100, 1500), 2),
        ('Claim Rewards Event', claim_rewards, None, 2),
        ('Test Screenshot', take_screenshot, None, 1),

        ('Return', tap_macro, (51, 32), 10),
        ('Menu', tap_macro, (1226, 39), 3),
        ('Rescue', tap_macro, (780, 405), 4),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Global', tap_macro, (660, 1), 2),
        ('Limited Banner', tap_macro, (105, 260), 4),
        ('Space', tap_macro, (1141, 663), 5),
        ('Summoning Might', summon_might, None, 6),
        ('Summoning Rare', summoning_rare, None, 5),
        ('Space', tap_macro, (1141, 663), 3),
        ('Rescue 10x', tap_macro, (1141, 663), 3),
        ('Summoning Rare', summoning_rare, None, 5),
        ('Space', tap_macro, (1141, 663), 3),
        ('Rescue 10x', tap_macro, (1141, 663), 3),
        ('Summoning Rare', summoning_rare, None, 5),
        ('Space', tap_macro, (1141, 663), 3),
        ('Rescue 10x', tap_macro, (1141, 663), 3),
        ('Summoning Rare', summoning_rare, None, 5),
        ('Space', tap_macro, (1141, 663), 3),
        ('Rescue 10x', tap_macro, (1141, 663), 3),
        ('Summoning Rare', summoning_rare, None, 5),
        ('Space', tap_macro, (1141, 663), 3),
        ('Summons Shop', tap_macro, (1039, 29), 3),
        ('Exchanging', tap_macro, (847, 418), 5),
        ('Amplification Anchor', tap_macro, (350, 368), 3),
        ('Max', tap_macro, (550, 554), 4),
        ('Buying Anchors', tap_macro, (836, 556), 6),
        ('Global', tap_macro, (660, 1), 4),
        ('Return', tap_macro, (51, 32), 3),
        ('Global', tap_macro, (660, 1), 2),
        ('Rescue 10x', tap_macro, (1141, 663), 3),
        ('Summoning Might', summon_might, None, 6),
        ('Summoning 10x Till 1x', summoning_till_10x, None, 5),
        ('Global', tap_macro, (660, 1), 3),
        ('Summoning Till Empty', summoning_till_empty, None, 5),
        ('Return', tap_macro, (51, 32), 3),
        ('Combatants', tap_macro, (1166, 384), 6),
    ]
    return steps

def execute_macro_steps(guest_data, steps, log_func, pause_event):
    """Execute macro steps for all accounts in parallel
    
    Args:
        guest_data: List of (instance_name, guest_name) tuples
        steps: List of macro steps to execute
        log_func: Logging function
        pause_event: Threading event for pause control
    """
    for log_text, action_func, coords, sleep_duration in steps:
        pause_event.wait()
        log_func(log_text)

        if action_func == "input_name":
            # Special case for name input
            for instance_name, guest_name in guest_data:
                pause_event.wait()
                input_macro(instance_name, guest_name)
                log_func(f"[{instance_name}] Input guest name: {guest_name}")
                
        else:
            # Normal actions with threading
            threads = []
            for instance_name, _ in guest_data:
                pause_event.wait()
                if coords is not None:
                    t = threading.Thread(target=action_func, args=(instance_name, *coords))
                else:
                    t = threading.Thread(target=action_func, args=(instance_name,))
                t.start()
                threads.append(t)

            # Wait for all threads
            for t in threads:
                t.join()

        # Sleep with pause checking
        for _ in range(sleep_duration):
            pause_event.wait()
            time.sleep(1)